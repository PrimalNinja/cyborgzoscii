// CyborgZOSCII v20250805
// (c) 2025 Cyborg Unicorn Pty Ltd.
// This software is released under MIT License.

/*jsl:ignore*/

function toZOSCII(h,a,n,k,s){var u=(new Date).getTime(),b,t=0,e=0,l=0,q=Array(256),f=Array(256),c=Array(256),r=Array(256),d,m,g,p=!1;"string"===typeof a?(a=(new TextEncoder).encode(a),p=!0):p=!1;for(b=0;256>b;b++)q[b]=0,r[b]=0;for(b=0;b<n.length;b++){g=n[b];for(d=g.start;d<g.start+g.size;d++)m=h[d],q[m]++}for(b=0;256>b;b++)f[b]=Array(q[b]),c[b]=0;for(b=0;b<n.length;b++){g=n[b];for(d=g.start;d<g.start+g.size;d++)m=h[d],f[m][c[m]]=d,c[m]++}for(b=0;b<a.length;b++)c=a[b],k&&(c=k(c,s)),0<=c&&256>c&&f[c]&&
0<f[c].length?e++:(l++,10>=l&&(d=a[b].toString(16).toUpperCase(),2>d.length&&(d="0"+d),p?console.log("Missing character: '"+String.fromCharCode(a[b])+"' (code "+a[b]+"/0x"+d+" -> "+c+")"):console.log("Missing byte: "+a[b]+" (0x"+d+" -> "+c+")")));p?(console.log("Characters found in ROM: "+e),console.log("Characters missing from ROM: "+l)):(console.log("Bytes found in ROM: "+e),console.log("Bytes missing from ROM: "+l));e=Array(e);for(b=0;b<a.length;b++)c=a[b],k&&(c=k(c,s)),0<=c&&(256>c&&f[c]&&0<f[c].length)&&
(r[c]++,l=Math.floor(Math.random()*f[c].length),e[t]=f[c][l],t++);k=(new Date).getTime()-u;console.log("ZOSCII Performance:");console.log("- Binary size: "+h.length+" bytes");console.log("- Input length: "+a.length+(p?" characters":" bytes"));console.log("- Memory blocks: "+n.length);console.log("- Execution time: "+k+"ms");console.log("- Output addresses: "+e.length);return{addresses:e,inputCounts:r,romCounts:q}}
function petsciiToAscii(h,a){return[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a][h]}
function ebcdicToAscii(h,a){return[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,32,a,a,a,a,a,a,a,a,a,a,46,60,40,43,124,38,a,a,a,a,a,a,a,a,a,33,36,a,41,59,a,45,47,a,a,a,a,a,a,a,a,a,44,37,95,62,63,a,a,a,a,a,a,a,a,a,96,58,35,64,39,61,34,a,97,98,99,100,101,102,103,104,105,a,a,a,a,a,a,a,106,107,108,109,110,111,112,113,114,a,a,a,a,a,a,a,a,115,116,117,118,119,120,121,122,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,65,66,
67,68,69,70,71,72,73,a,a,a,a,a,a,a,74,75,76,77,78,79,80,81,82,a,a,a,a,a,a,a,a,83,84,85,86,87,88,89,90,a,a,a,a,a,a,48,49,50,51,52,53,54,55,56,57,a,a,a,a,a,a][h]};
